<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Free Range</title>
  <link rel="stylesheet" type="text/css" href="main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
  <!-- Latest compiled and minified JavaScript -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
  <!-- Latest compiled and minified Locales -->
  <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/locale/bootstrap-table-zh-CN.min.js"></script>
  <script src="js/web3.min.js"></script>
  <script type="text/javascript" src="js/app.js"></script>
</head>
<body>
  <div class="container">
    <div class="paragraphs">
      <div class="alert alert-success" role="alert" id="success" style='display:none'></div>
      <div class="alert alert-error" role="alert" id="error" style='display:none'></div>
      <div class="row">
        <div class="span4">
          <img width="100" style="float:left" src="https://ico.frco.work/wp-content/uploads/2018/01/eggs-coin.jpg"/>
          <div class="content-heading"><h3>Free Range <strong>EggFuture</strong></h3></div>
          <!-- <p style="clear:both">Donec id elit non mi porta gravida at eget metus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.</p> -->
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-6 col-md-4">
        <div class="row">
          <div class="col"><strong>Total Supply:</strong></div>
          <div class="col" style="text-align:right;" id="total_supply">0 ðŸ¥š</div>
        </div>
        <div class = "row">
          <div class="col"><strong>Total Allocated:</strong></div>
          <div class="col" style="text-align:right;" id="total_allocated">0 ðŸ¥š</div>
        </div>
        <div class = "row">
          <div class="col"><strong>% Allocated:</strong></div>
          <div class="col" style="text-align:right;" id="percent_allocated">0%</div>
        </div>
      </div>
    </div>
    <span><strong>Recent Winners</strong></span>
    <div id="winners"></div>
    <div>&nbsp;</div>

    <div class="dropdown" id="admin_controls">
      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        Select a Function
      </button>
      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <a class="dropdown-item" href="#" onclick="$('#modal_add_user').modal('show')">Add User</a>
        <a class="dropdown-item" href="#" onclick="$('#modal_add_admin').modal('show')">Add Admin</a>
        <a class="dropdown-item" href="#" onclick="$('#modal_draw_user').modal('show')">Draw User</a>
        <a class="dropdown-item" href="#" onclick="$('#modal_update_user_balance').modal('show')">Update User Balance</a>
      </div>
    </div>
    <div>&nbsp;</div>


<table id="table"
  class="table table-striped "
  data-locale="en-US"
  data-sort-name="name"
  data-sort-order="asc"
  data-pagination="true"
  data-search="true"
  data-height="460">
  <thead>
    <tr>
      <th data-field="name" data-sortable="true">Name</th>
      <!-- <th data-field="email" data-sortable="true">Email</th> -->
      <th data-field="balance" data-formatter="balanceFormatter" data-sortable="true">Balance</th>
    </tr>
  </thead>
</table>
</div>

<script>
var web3;
window.addEventListener('load', function() {

  // Checking if Web3 has been injected by the browser (Mist/MetaMask)
  if (typeof web3 !== 'undefined') {
    // Use Mist/MetaMask's provider
    web3js = new Web3(web3.currentProvider);
    console.log("Meta MaskMask working");
  } else {
    console.log('No web3? You should consider trying MetaMask!')
    // fallback - use your fallback strategy (local node / hosted node + in-dapp id mgmt / fail)
    web3js = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
  }

  // Now you can start your app & access web3 freely:
  startApp()

});
</script>

<!-- Modals -->
<!-- Add User -->
<div class="modal fade" id="modal_add_user" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add User</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form onsubmit="return false;">
          <div class="form-group">
            <label for="name">Name</label>
            <input class="form-control" id="name" type="text">
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input class="form-control" id="email" type="text">
          </div>
          <div class="form-group">
            <label for="initial_amount">Initial Amount</label>
            <input class="form-control" id="initial_amount" type="text">
          </div>
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addUser($('#name').val(),$('#email').val(),$('#initial_amount').val(), (e,r)=> {$('#modal_add_user').modal('hide')})">Add User</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Admin -->
<div class="modal fade" id="modal_add_admin" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Add Admin</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form onsubmit="return false;">
          <div class="form-group">
            <label for="address">Admin Address</label>
            <input class="form-control" id="address" type="text">
          </div>
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="addAdmin($('#address').val(), (e,r)=> {$('#modal_add_admin').modal('hide')})">Add Admin</button>
      </div>
    </div>
  </div>
</div>

<!-- Update User Balance -->
<div class="modal fade" id="modal_update_user_balance" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Update User Balance</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form onsubmit="return false;">
          <div class="form-group">
            <label for="user_email">User Email</label>
            <input class="form-control" id="user_email" type="text">
          <script>
          $('#user_email').on('input', function() {
            var user = userHash[web3.sha3($('#user_email').val())];
            if(user) {
              $('#user_data').html('<strong>'+user.name+'</strong>: ' + user.balance.toLocaleString() + egg);
            } else {
              $('#user_data').html('');
            }
          });
          </script>
          </div>
          <div id="user_data"></div>
          <div class="form-group">
            <label for="user_value">User Balance</label>
            <input class="form-control" id="user_balance" type="text">
          </div>
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="setUserBalance($('#user_email').val(),$('#user_balance').val(), (e,r)=> {$('#modal_update_user_balance').modal('hide')})">Update</button>
      </div>
    </div>
  </div>
</div>

<!-- Draw User -->
<div class="modal fade" id="modal_draw_user" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Draw User</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form onsubmit="return false;">
          <div class="form-group">
            <label for="address">Award Value</label>
            <input class="form-control" id="award_value" type="text">
          </div>
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="drawUser($('#award_value').val(), (e,r)=> {$('#modal_draw_user').modal('hide')})">Draw</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
